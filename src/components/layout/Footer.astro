---
import FooterAnnouncementEntry from '@components/announcement/FooterAnnouncementEntry';
import { MAX_WIDTH } from '@constants/layout';
import { siteConfig } from '@constants/site-config';
import { getSiteStats } from '@lib/stats';
import { cn } from '@lib/utils';
import { Icon } from 'astro-icon/components';
import SakuraSVG from '../svg/SakuraSvg';

interface Props {
  className?: string;
}

const { className } = Astro.props;

const stats = await getSiteStats();
const currentYear = new Date().getFullYear();
const startYear = siteConfig?.startYear ?? currentYear;
---

<footer class={cn('mt-auto pb-6', className)}>
  <div class={cn('mx-auto flex flex-col items-center gap-3 px-6 md:pb-10 md:px-3', MAX_WIDTH.content)}>
    <!-- Announcements Entry -->
    <!-- <FooterAnnouncementEntry client:load /> -->

    <!-- Site Stats -->
    <div class="text-muted-foreground flex flex-wrap items-center justify-center gap-6 text-sm md:gap-4">
      <button class="flex items-center gap-2 opacity-75 transition-opacity duration-300 hover:opacity-100" title="站点总字数">
        <Icon name="ri:file-text-line" class="h-4 w-4" />
        <span class="font-medium">{stats.formattedWords}</span>
        <span class="text-xs">字</span>
      </button>

      <div class="bg-muted-foreground/30 h-4 w-px"></div>

      <button class="flex items-center gap-2 opacity-75 transition-opacity duration-300 hover:opacity-100" title="站点阅读时长">
        <Icon name="ri:time-line" class="h-4 w-4" />
        <span class="font-medium">{stats.formattedTime}</span>
      </button>

      <div class="bg-muted-foreground/30 h-4 w-px"></div>

      <button class="flex items-center gap-2 opacity-75 transition-opacity duration-300 hover:opacity-100" title="文章总数">
        <Icon name="ri:article-line" class="h-4 w-4" />
        <span class="font-medium">{stats.postCount}</span>
        <span class="text-xs">篇</span>
      </button>
    </div>

    <!-- Line 1: Theme Info -->
    <div class="text-muted-foreground/80 flex items-center gap-1 text-xs">
      <span class="opacity-75">Theme</span>
      <a
        href="https://github.com/cosZone/astro-koharu"
        target="_blank"
        class="footer-link font-medium transition-all duration-300"
      >
        koharu
      </a>
      <SakuraSVG className="mx-0 size-5 animate-spin text-[#FFC0CB] duration-10000" />
      <span class="opacity-75">by</span>
      <a
        href="https://github.com/cosZone"
        target="_blank"
        class="footer-link font-medium transition-all duration-300"
      >
        cosZone
      </a>
    </div>

    <!-- Line 2: Copyright Info -->
    <div class="text-muted-foreground flex items-center gap-0 text-[12px]">
      <span class="opacity-75">Copyright © {startYear}-{currentYear} by {siteConfig.author} All Rights Reserved.</span>
    </div>

    <!-- Beian Info -->
    {
      siteConfig.beian && (
        <div class="text-muted-foreground/40 mt-3 flex items-center gap-2 text-[10px] md:text-xs">
          {siteConfig.beian.gongan && (
            <a
              href={`http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=${siteConfig.beian.gongan.match(/\d+/)?.[0]}`}
              target="_blank"
              class="hover:text-primary transition-colors"
            >
              {siteConfig.beian.gongan}
            </a>
          )}
          {siteConfig.beian.gongan && siteConfig.beian.icp && <span class="opacity-50">|</span>}
          {siteConfig.beian.icp && (
            <a href="https://beian.miit.gov.cn/" target="_blank" class="hover:text-primary transition-colors">
              {siteConfig.beian.icp}
            </a>
          )}
        </div>
      )
    }
  </div>
</footer>

<style>
  .footer-link {
    opacity: 0.75;
    position: relative;
  }

  .footer-link:hover {
    opacity: 1;
  }

  .footer-link::after {
    content: '';
    position: absolute;
    bottom: -2px;
    left: 0;
    width: 0;
    height: 1px;
    background: currentColor;
    transition: width 0.3s ease;
  }

  .footer-link:hover::after {
    width: 100%;
  }
</style>
